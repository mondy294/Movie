var ChineseChatV2;(function(n){function bf(n){o&&(t=n,re(),ne(),df(),y++,gu()?bi?(rf(),li(!1),pe(ui)):d(ui,"externallink"):typeof t.traceId=="undefined"||t.traceId==null||t.traceId==""?d(t.searchQuery,"searchbox"):kf("searchbox"),oe(),ve())}function kf(n){var i=sj_gx(),r=(new Date).getTime();i.ontimeout=function(){d(t.searchQuery,"searchbox");c()&&(r=(new Date).getTime()-r,Log.Log("FailGet",f,"getHookResponse",!1,"timeTaken",r.toString()))};i.open("POST",t.UrlForHookResponse,!0);i.setRequestHeader("Content-Type","text/plain");i.timeout=3e3;sj_be(i,"readystatechange",function(){if(i.readyState==4){r=(new Date).getTime()-r;var u=!1;i.status==200&&i.responseText?(u=cf(i.responseText,n),c()&&(u?Log.Log("SuccessGet",f,"getZoChatBySendText",!1,"timeTaken",r.toString(),"resDT",er,"resText",or,"AnswerFeed",ei,"EmotionInfo",ki,"CustomLog",di):Log.Log("FailGet",f,"getZoChatBySendText",!1,"timeTaken",r.toString(),"resType","HookResponse"))):d(t.searchQuery,"searchbox")}});i.send(t.traceId)}function gu(){for(var n,r,f=t.LinkUrl.split("?")[1].split("&"),u,i=0;i<f.length;i++)n=f[i].split("="),n[0]=="form"&&(n[1]=="000015"||n[1]=="MO0036"||n[1]=="MO0037"||n[1]=="DSBBCT1")&&(lt=!0,u=n[1]),n[0]=="q"&&(ui=decodeURI(n[1]));if(lt)for(lt=!1,r=[],u=="000015"?r=["讲笑话","成语接龙","电影推荐","男女友类型测试","求生欲","土味情话套路"]:u=="MO0036"?r=["星座运势"]:u=="MO0037"?r=["白羊座 星座运势","金牛座 星座运势","双子座 星座运势","巨蟹座 星座运势","狮子座 星座运势","处女座 星座运势","天秤座 星座运势","天蝎座 星座运势","射手座 星座运势","摩羯座 星座运势","水瓶座 星座运势","双鱼座 星座运势"]:u=="DSBBCT1"&&(r=["星座爱情运","速配星座","星座事业运","白羊座","金牛座","双子座","巨蟹座","狮子座","处女座","天秤座","天蝎座","射手座","摩羯座","水瓶座","双鱼座"]),i=0;i<r.length;i++)if(ui==r[i]){u=="DSBBCT1"&&(bi=!0);lt=!0;break}return lt}function df(){var n,i,u;ce();le();ee();he();n=_ge("ev_tb_maxclose");sj_be(n,"click",function(){ie()});sj_be(r,"click",function(){tr?tr=!1:li(!0)});sj_be(_ge(fu),"click",nf);t.IsMobileChat&&(et=window.screen.width-69,et>348?et=348:et<270&&(et=270),i=et-72,_ge("ev_talkbox_max").style.width=et+"px",_ge("ev_send_text").style.width=i+"px");u=_ge(vi);sj_be(u,"keydown",function(n){n.keyCode==13&&(nf(),sj_pd(n))});setInterval(gf,50)}function gf(){var n=window.innerHeight-300,t,i;vr!=n&&(vr=n,n<388?(_ge("ev_talkbox").style.height=n+"px",_ge("ev_tb_header_dropdown_background").style.height=n+"px",t=n+91,_ge("ev_disable_popup_background").style.height=t+"px",_ge("ev_iframe_talk").style.height=t+"px",_ge("ev_enlarge_background").style.height=t+"px",n<282?(i=n-131,i<51&&(i=51),_ge("ev_disable_popup_setting").style.top=i+"px"):_ge("ev_disable_popup_setting").style.top="151px"):(_ge("ev_talkbox").style.height="388px",_ge("ev_tb_header_dropdown_background").style.height="388px",_ge("ev_disable_popup_background").style.height="479px",_ge("ev_iframe_talk").style.height="479px",_ge("ev_enlarge_background").style.height="479px"))}function ne(){var n=o.parentElement,t=_ge("b_content");t&&t.insertBefore(o,t.firstChild);n&&n.parentElement&&n.tagName.toLowerCase()=="li"&&Lib.CssClass.contains(n,"b_ans")&&n.parentElement.removeChild(n)}function nf(){var r=_ge(vi),t=r.value,e=(new Date).getTime();if(t){sj_cook.setNoCrumbs(vu,"0",!0,"/",10080);nr&&(sj_cook.clear(pi),nr=!1);r.value="";var u=g(t,!1,!1,"","1"),n=_ge(a),i=MsnShared.getElementsByClassName("ev_zo_typing","div",n);i&&i.length>0?n.insertBefore(u,i[0].parentElement):n.appendChild(u);n.scrollTop=n.scrollHeight;y==0&&iu();y++;d(t,"chatbox");c()&&Log.Log("DHTMLClick",f,"sendText",!1,"UQ",t,"ST",e.toString())}}function d(n,r){var o,e,h,u,a;t.ZoChatV2Url&&(o=!1,gt=="True"&&(o=!0),e=(new Date).getTime(),n=Aes.encrypt(n,t.ZoAESPassword,t.ZoAESBitCount),h={NormalizedQuery:n,IsPopNow:o},u=sj_gx(),u.open("POST",t.ZoChatV2Url,!0),sj_be(u,"readystatechange",function(){var n,t;u.readyState==4&&(e=(new Date).getTime()-e,n=!1,r!="disablechat"?(u.status==200&&u.responseText?(n=cf(u.responseText,r),n||ir()):(ir(),t=["脑子不转啦，等我休息一下","我刚刚想说啥来着呢...","你猜我会回复你啥？","词穷了，等我歇会儿","（让我想想怎么回复你）"],ni(t[Math.floor(Math.random()*t.length)],"1")),c()&&(n?Log.Log("SuccessGet",f,"getZoChatBySendText",!1,"timeTaken",e.toString(),"resDT",er,"resText",or,"AnswerFeed",ei,"EmotionInfo",ki,"CustomLog",di):Log.Log("FailGet",f,"getZoChatBySendText",!1,"timeTaken",e.toString()))):(u.status==200&&u.responseText?ni("再见啦~如果想我的话，在必应国内版搜索【小冰】，我就会出来陪你啦~","1"):ni("不好意思，本次操作失败了~已反馈，请您稍后再试~","1"),MsnShared.show(k),MsnShared.hide(b),sj_cook.set(st,ii,s),ut.className=ft,tt.innerHTML=bt,i=s,MsnShared.hide(ht),MsnShared.hide(l),setTimeout(se,7e3),c()&&(n?Log.Log("SuccessDiable",f,"disableChatbot",!1,"timeTaken",e.toString()):Log.Log("FailDisable",f,"disableChatbot",!1,"timeTaken",e.toString()))))}),a={zoTextResponse:su,zoIsGCSResponse:ou,zoSearchQuery:t.searchQuery,zoTimestampUtc:hu,zoIsStartOfSession:eu,zoRequestId:te(),conversationId:t.conversationId,query:h,from:r,traceId:t.traceId},eu="false",ou="true",u.send(JSON.stringify(a)))}function tf(n,t){var r,i,u;y--;n&&n.length>0&&(r=_ge(a),i=MsnShared.getElementsByClassName("ev_zo_typing","div",r),i&&i.length>0?y==0?(i[0].innerHTML="",tu(i[0],n,t),MsnShared.removeClass(i[0],"ev_zo_typing")):(u=g("",!0,!1,n,t),r.insertBefore(u,i[0].parentElement)):(u=g("",!0,!1,n,t),r.appendChild(u)),r.scrollTop=r.scrollHeight,er=(new Date).getTime().toString())}function g(n,i,r,f,e){var p,v,s,c,y,h,w,o,b,l;return r&&(p=_ge(a),v=MsnShared.getElementsByClassName("ev_zo_typing","div",p),v&&v.length>0)?null:(s=sj_ce("div",null,"ev_msg_wrapper"),i?(h=sj_ce("div","ev_zo_img","ev_zo_img"),hf()&&(h.className="ev_zo_img_dm"),s.appendChild(h)):(c=typeof Identity!="undefined"&&Identity.wlProfile&&Identity.wlProfile(),c&&c.img?(y=sj_ce("img",null,"ev_my_img"),y.src=c.img,s.appendChild(y)):(h=sj_ce("div",null,"ev_my_img"),s.appendChild(h))),w=i?"ev_zo_msg":"ev_my_msg",o=sj_ce("div",null,w),t.IsMobileChat&&(b=et-146,o.style.maxWidth=b+"px"),r?(o.innerHTML="<span><\/span>",MsnShared.addClass(o,"ev_zo_typing")):i&&f&&f.length>0?tu(o,f,e):e=="2"?(l=sj_ce("img","ev_zo_image","ev_zo_image"),l.src=n,MsnShared.removeClass(o,"ev_zo_msg"),s.appendChild(l),l.onclick=function(){it.className="ev_show_enlarge_img";ct.className="ev_enlarge_img";ct.src=n;u.src=n;u.complete?ur():u.onload=function(){ur()}}):o.innerText=n,s.appendChild(o),s)}function tu(n,i,r){for(var e,o,l,s,h=0;h<i.length;h++)e=i[h],e.Entity&&(e.IsEntity?(o=sj_ce("a",null,"ev_zo_entity"),o.href=t.HookHyperlink?MsnShared.stringFormat(cr,encodeURI(du),fi):MsnShared.stringFormat(cr,encodeURI(e.Entity),fi),o.innerText=e.Entity,n.appendChild(o),sj_be(o,"click",function(){n.id=="ev_hook_header_text_reply"&&(rr(vt),gt="True",sj_cook.set(st,nu,gt));c()&&Log.Log("DHTMLClick",f,"zoentity",!1,"zoentity",o.innerHTML)}),sj_be(o,"mousemove",function(n){var t=MsnShared.getElementsByClassName("ev_zo_tooltip","div",_d.body),i,r;t&&t.length>0&&(MsnShared.show(t[0]),i=n.clientX+_d.documentElement.scrollLeft,r=n.clientY+_d.documentElement.scrollTop,t[0].style.top=r+26+"px",t[0].style.left=i+"px")}),sj_be(o,"mouseout",function(){var n=MsnShared.getElementsByClassName("ev_zo_tooltip","span",_d.body);n&&n.length>0&&MsnShared.hide(n[0])})):r=="2"?(l=sj_ce("img","ev_zo_image","ev_zo_image"),l.src=e.Entity,MsnShared.removeClass(n,"ev_zo_msg"),n.appendChild(l),l.onclick=function(){it.className="ev_show_enlarge_img";ct.className="ev_enlarge_img";ct.src=e.Entity;u.src=e.Entity;u.complete?ur():u.onload=function(){ur()}}):(s=sj_ce("span",null,null),s.innerText=e.Entity,n.appendChild(s)));t.EnableShowAnswerFeed&&(s=sj_ce("span",null,null),s.innerText="["+ei+"]",n.appendChild(s))}function ot(){return((1+Math.random())*65536|0).toString(16).substring(1)}function te(){return(ot()+ot()+ot()+ot()+ot()+ot()+ot()+ot()).toLowerCase()}function rf(){MsnShared.show(o)}function iu(){var t=g("",!0,!0,"",""),n;t&&(n=_ge(a),n.appendChild(t),n.scrollTop=n.scrollHeight)}function ir(){var i,n,t;if(y--,y==0&&(i=_ge(a),n=MsnShared.getElementsByClassName("ev_zo_typing","div",i),n&&n.length>0))for(t=0;t<n.length;t++)n[t].parentElement.parentElement.removeChild(n[t].parentElement)}function li(n){if(e&&r){MsnShared.removeClass(o,"ev_talkbox_wrapper_min");MsnShared.addClass(o,"ev_talkbox_wrapper");MsnShared.show(e);MsnShared.hide(r);var t=_ge(a);t.scrollTop=t.scrollHeight;n&&(rr(vt),i==yt||i==ri?(MsnShared.show(b),MsnShared.hide(k)):au&&(au=!1,y=1,d("","click")),c()&&Log.Log("DHTMLClick",f,"maximizeZo",!1,"botType",i))}}function ie(){e&&r&&(MsnShared.removeClass(o,"ev_talkbox_wrapper"),MsnShared.addClass(o,"ev_talkbox_wrapper_min"),MsnShared.hide(e),MsnShared.show(r),rr(hr),i==s?(ai(),r.className="ev_talkbox_cn_min",h.className=typeof _ge("ent-car-exp")!="undefined"&&_ge("ent-car-exp")!==null?"ev_min_cn_img_casol":"ev_min_cn_img"):(sb_ct(ci),sb_ct(hi),sb_ct(dt),h.style.cssText=";background-image: url("+t.VirtualCharacterEntryUrl+")",r.className="ev_talkbox_virtual_min",h.className="ev_min_virtual_img"),c()&&Log.Log("DHTMLClick",f,"minimizeZo",!1,"botType",i))}function rr(n){n==vt||n==hr?sj_cook.set(yi,sr,n):sj_cook.clear(yi)}function c(){return typeof Log!="undefined"&&Log!==null&&typeof Log.Log!="undefined"}function re(){var n,ot,lt,hi,y,vt,u,dt,d,g,ni,ti,ft,ui,f,fi,ki,di,et;i=sj_cook.get(st,ii);i==null&&(i=s);i!=yt&&i!=ri||t.iframeTalkStatus&&navigator.cookieEnabled||(i=s,sj_cook.set(st,ii,i));t.HookHyperlink&&(gt=sj_cook.get(st,nu),gt==null&&(gt="false"),sj_cook.clear(nu));n=sj_ce("div",null,"ev_tb_header");v.innerText="关闭";ot=sj_ce("div","ev_disable_popup_setting_pop","ev_disable_popup_setting_pop");ot.innerText="确认要关闭吗？";lt=sj_ce("div","ev_disable_popup_setting_body","ev_disable_popup_setting_body");lt.innerText="接下来的很长一段时间，你都不会看到我了";var at=sj_ce("div","ev_disable_popup_setting_bottom","ev_disable_popup_setting_bottom"),oi=sj_ce("div","ev_disable_popup_setting_btn1","ev_disable_popup_setting_btn1"),si=sj_ce("div","ev_disable_popup_setting_btn2","ev_disable_popup_setting_btn2");if(oi.innerText="确定",si.innerText="再想想",at.appendChild(oi),at.appendChild(si),l.appendChild(ot),l.appendChild(lt),l.appendChild(at),e.appendChild(v),e.appendChild(ht),e.appendChild(l),hi=sj_ce("div","ev_tb_disable","ev_tb_disable"),n.appendChild(hi),y=sj_ce("div","ev_tb_header_text","ev_tb_disable_header_text"),y.appendChild(tt),y.appendChild(nt),n.appendChild(y),vt=sj_ce("span","ev_tb_maxclose","ev_tb_disable_close"),n.appendChild(vt),vt.appendChild(sj_ce("span","ev_tb_maxclose_img","ev_tb_close_img")),ut.innerText=bt,pt.innerText=yr,wt.innerText=pr,u=sj_ce("div","ev_tb_header_dropdown_button","ev_tb_header_dropdown_button"),dt=sj_ce("div","ev_tb_header_dropdown_text","ev_tb_header_dropdown_text"),dt.innerText="点击切换聊天对象",rt.appendChild(dt),rt.appendChild(u),rt.appendChild(sj_ce("div","ev_tb_header_dropdown_background",null)),u.appendChild(ut),u.appendChild(pt),u.appendChild(wt),d=sj_ce("div","ev_send_input",null),g=sj_ce("textarea",vi,"ev_send_text"),g.setAttribute("type","text"),g.setAttribute("placeholder",t.placeHolder),ni=sj_ce("div",fu,"ev_send_button"),ni.appendChild(sj_ce("div","ev_send_button_img","ev_send_button_img")),d.appendChild(g),d.appendChild(ni),e.appendChild(n),ti=sj_ce("div","ev_privacy_text_top",null),ti.innerText="由红棉小冰提供的虚拟人类已唤醒，可以随时开始聊天啦",t.ShowTrendingQuery){var ui=sj_ce("div","ev_privacy_text_bottom_text_bubble",null),f=sj_ce("div","ev_privacy_text_bottom_bubble",null),ci=sj_ce("div","ev_bubblelist_title",null);ci.innerText="Bing热搜";f.appendChild(ci);ft=sj_ce("marquee","ev_bubblelist_0","ev_bubblelist");ft.innerHTML="<span><\/span>";MsnShared.addClass(ft,"ev_zo_typing");f.appendChild(ft)}else ui=sj_ce("div","ev_privacy_text_bottom_text",null),f=sj_ce("div","ev_privacy_text_bottom",null);ui.innerText="本服务由小冰公司运营";f.appendChild(ui);e.appendChild(rt);fi=sj_ce("span",a,"ev_talkbox");fi.appendChild(ti);it.appendChild(ct);it.appendChild(ar);it.appendChild(lf);e.appendChild(it);k.appendChild(fi);k.appendChild(f);k.appendChild(d);e.appendChild(k);e.appendChild(b);r.appendChild(h);i==s?(kt=!0,h.style.cssText=";background-image: url("+t.BlinkEyeEntryUrl+"); width: 75px",r.className="ev_talkbox_cn_min",h.className=typeof _ge("ent-car-exp")!="undefined"&&_ge("ent-car-exp")!==null?"ev_min_cn_img_casol":"ev_min_cn_img"):(h.style.cssText=";background-image: url("+t.VirtualCharacterEntryUrl+")",r.className="ev_talkbox_virtual_min",h.className="ev_min_virtual_img");var c=sj_ce("div","ev_hook_header","ev_hook_header"),gi=sj_ce("div","ev_hook_header_img","ev_hook_header_img"),li=sj_ce("div","ev_hook_header_isRead","ev_hook_header_isRead"),ei=sj_ce("div","ev_hook_header_text","ev_hook_header_text"),ai=sj_ce("div","ev_hook_header_text_title","ev_hook_header_text_title"),yi=sj_ce("div","ev_hook_header_text_reply","ev_hook_header_text_reply");ai.innerText=bt;yi.innerText=vf;li.innerText="1";var nr=sj_ce("div","ev_hook_header_close","ev_hook_header_close"),pi=sj_ce("div","ev_hook_send","ev_hook_send"),wi=sj_ce("div","ev_hook_send_input","ev_hook_send_input"),bi=sj_ce("div","ev_hook_send_input_placeholder","ev_hook_send_input_placeholder");bi.innerText="回复小冰";wi.appendChild(bi);ei.appendChild(ai);ei.appendChild(yi);c.appendChild(gi);c.appendChild(li);c.appendChild(ei);c.appendChild(nr);pi.appendChild(wi);p.appendChild(c);p.appendChild(pi);o.appendChild(p);o.appendChild(e);o.appendChild(r);typeof _ge("sbBoxCnt")!="undefined"&&_ge("sbBoxCnt")!==null&&(dr=!0,w.src=t.EntranceAnimationUrl,_ge("sbBoxCnt").appendChild(w),ki=MsnShared.getElementsByClassName("b_unarfo","div",_ge("uaanswer")),di=ue(ki[0].innerText,'12px/1.6 "Microsoft Yahei"'),w.style.left=di+"px",uf(),ku=!0);et=sj_ce("div","","ev_zo_tooltip");et.innerText="搜索";_d.body.appendChild(et);MsnShared.hide(et)}function ue(n,t){var u=document.createElement("canvas"),i=u.getContext("2d"),r;return i.font=t||"12px",r=i.measureText(n),r.width}function uf(){navigator.userAgent.toLowerCase().indexOf("trident")>-1&&(w.style.top="-14px")}function fe(){nt.className&&nt.className!="ev_tb_headerselect_open"?(nt.className="ev_tb_headerselect_open",rt.className="ev_tb_header_dropdown_open",v.className=="ev_tb_disable_setting"&&(v.className="b_hide"),l.className="b_hide",ht.className="b_hide"):(nt.className="ev_tb_header_select_close",rt.className="ev_tb_header_dropdown_close")}function ee(){sj_be(nt,"click",function(){fe()});sj_be(_ge("ev_talkbox_wrapper"),"click",function(n){n.target.className=="ev_tb_disable"?v.className=="b_hide"&&l.className=="b_hide"?(v.className="ev_tb_disable_setting",nt.className=="ev_tb_headerselect_open"&&(nt.className="ev_tb_header_select_close",rt.className="ev_tb_header_dropdown_close")):l.className=="ev_disable_popup_setting"?(l.className="b_hide",ht.className="b_hide"):v.className="b_hide":n.target.className=="ev_tb_disable_setting"?l.className=="b_hide"?(v.className="b_hide",l.className="ev_disable_popup_setting",ht.className="ev_disable_popup_background"):(l.className="b_hide",ht.className="b_hide"):v.className=="ev_tb_disable_setting"&&(v.className="b_hide")});sj_be(_ge("ev_disable_popup_setting_btn1"),"click",function(){d("##Disable##","disablechat")});sj_be(_ge("ev_disable_popup_setting_btn2"),"click",function(){l.className="b_hide";ht.className="b_hide"});sj_be(k,"click",function(){v.className=="ev_tb_disable_setting"&&(v.className="b_hide")});sj_be(_ge("uaseabox"),"click",function(){ef();dr=!1;fr(w,t.OverEyeAnimationUrl);oi=!0;w.style.top="-51px";sb_st(function(){oi&&(fr(w,t.OverEyeStaticAnimationUrl),gr=!0,oi=!1)},8e3)});sj_be(_d,"mouseup",function(n){n.target.id!="uaseabox"&&(uf(),(oi||gr)&&(oi=!1,gr=!1,fr(w,t.LooseHandAnimationUrl)))});sj_be(w,"click",function(){c()&&Log.Log("DHTMLClick",f,"clickSBA",!1)});sj_be(w,"mouseover",function(){c()&&Log.Log("DHTMLClick",f,"focusSBA",!1)});sj_be(it,"click",function(n){n.target.className!="ev_enlarge_img"&&MsnShared.hide(it)});sj_be(ar,"click",function(){MsnShared.hide(it)})}function ur(){var t=vr+91;ct.style.width="348px";var s=348*u.height/u.width,i=348,n=479,f=0,r=0,e=10,o=10;u.width/u.height>.83?t<479?s>t?(i=t*u.width/u.height,n=t,f=(348-i)/2,o=f+10):(n=348*u.height/u.width,r=(t-n)/2,e=r+10):(n=348*u.height/u.width,r=(479-n)/2,e=r+10):(t<479?(n=t,i=t*u.width/u.height):i=479*u.width/u.height,i>348?(i=348,n=348*u.height/u.width,r=(479-n)/2,e=r+10):f=(348-i)/2);ct.style.cssText=";height: "+n+"px; width: "+i+"px; margin-top: "+r+"px; margin-left: "+f+"px";ar.style.cssText=";top: "+e+"px; right: "+o+"px"}function fr(n,t){var i=new Image;i.src=t;i.complete?n.src=t:i.onload=function(){n.src=t}}function oe(){sb_st(function(){dr&&fr(w,t.StaticAnimationUrl)},8e3)}function se(){MsnShared.hide(_ge("ev_talkbox_wrapper"))}function he(){sj_be(ut,"click",function(){ru(s)});sj_be(pt,"click",function(){ru(yt)});sj_be(wt,"click",function(){ru(ri)})}function ru(n){i=n;ut.className="ev_tb_header_dropdown_button_ice";pt.className="ev_tb_header_dropdown_button_boy";wt.className="ev_tb_header_dropdown_button_girl";nt.className="ev_tb_header_select_close";rt.className="ev_tb_header_dropdown_close";c()&&Log.Log("DHTMLClick",f,"selectBotType",!1,"botType",i);n==s?(ut.className=ft,tt.innerHTML=bt,y=1,d("","click"),MsnShared.show(k),MsnShared.hide(b)):(t.iframeTalkStatus&&navigator.cookieEnabled?(h.style.cssText=";background-image: url("+t.VirtualCharacterEntryUrl+")",n==yt?(pt.className=ft,tt.innerHTML=yr,b.src=pu):n==ri&&(wt.className=ft,tt.innerHTML=pr,b.src=wu),MsnShared.show(b),MsnShared.hide(k)):(MsnShared.show(k),ae(),MsnShared.hide(b),ut.className=ft,tt.innerHTML=bt,i=s),rr(vt));sj_cook.set(st,ii,i)}function ce(){sj_be(p,"click",function(n){n.target.className!="ev_hook_header_close"&&(MsnShared.show(e),_ge(vi).focus(),MsnShared.hide(p),MsnShared.hide(r))})}function le(){sj_be(_ge("ev_hook_header_close"),"click",function(){nr=!0;sj_cook.get(vu)?sj_cook.setNoCrumbs(pi,"TRUE",!0,"/",10080):sj_cook.setNoCrumbs(pi,"TRUE",!0,"/",20160);MsnShared.removeClass(o,"ev_talkbox_wrapper");MsnShared.addClass(o,"ev_talkbox_wrapper_min");ai();MsnShared.show(r);MsnShared.hide(p);MsnShared.hide(e)})}function uu(){i==s?(h.className=typeof _ge("ent-car-exp")!="undefined"&&_ge("ent-car-exp")!==null?"ev_min_cn_img_casol":"ev_min_cn_img",sj_cook.get(lr)?sj_cook.get(yu)?(si=!1,ai()):ff(";background-image: url("+t.WeakAttractEntryUrl+"); width: 80px",yu,1440):ff(";background-image: url("+t.StrongAttractEntryUrl+"); width: 100px; margin-right: 1px",lr,10080)):h.className="ev_min_virtual_img"}function ff(n,t,i){si=!0;kt=!1;h.style.cssText=n;sj_cook.setNoCrumbs(t,"TRUE",!0,"/",i);ci=sb_st(function(){si=!1;ai()},1e4)}function ai(){sb_ct(ci);sb_ct(hi);sb_ct(dt);kt=!0;ti(t.BlinkEyeEntryUrl);hi=sb_st(function(){kt=!1;ti(t.CloseEyeEntryUrl);dt=sb_st(function(){ti(t.KeepSleepEntryUrl)},5e3)},1e4)}function ae(){var t=g(af,!0,!1,"","1"),n=_ge(a);n.appendChild(t);n.scrollTop=n.scrollHeight}function ni(n,t){iu();var i=g(n,!0,!1,"",t);sb_st(function(){y=1;ir();var n=_ge(a);n.appendChild(i);n.scrollTop=n.scrollHeight},1500)}function ve(){var u=!1,e,n;r.onmousedown=function(n){e=n.clientY-r.offsetTop;_ge("ev_hook").className=="b_hide"&&(u=!0)};_d.onmousemove=function(t){var i,f,o,s;if(u)n=t.clientY-e,o=((i=_d.documentElement)===null||i===void 0?void 0:i.clientHeight)||((f=_d.body)===null||f===void 0?void 0:f.clientHeight),s=o-r.offsetHeight,n=Math.min(s,Math.max(0,n)),r.style.top=n+"px",tr=!0;else return};_d.onmouseup=function(){u=!1;tr&&c()&&Log.Log("DHTMLClick",f,"moveIcon",!1,"currentTop",n+"px")};sj_be(r,"mouseover",function(){i!=s||si||(sb_ct(ci),sb_ct(hi),sb_ct(dt),ti(t.BlinkEyeEntryUrl))});sj_be(r,"mouseout",function(){i!=s||si||ai()});sj_be(_ge("sb_form_q"),"click",function(){ef()})}function ti(n){var t=new Image;t.src=n;t.complete?h.style.cssText=";background-image: url("+n+"); width: 75px":t.onload=function(){h.style.cssText=";background-image: url("+n+"); width: 75px"}}function ef(){kt&&(sb_ct(ci),sb_ct(hi),sb_ct(dt),kt=!1,ti(t.CloseEyeEntryUrl),dt=sb_st(function(){ti(t.KeepSleepEntryUrl)},5e3))}function sf(n){var i=_ge("ev_bubblelist_0"),r=MsnShared.getElementsByClassName("ev_zo_entity","div",i),t,u;r&&r.length>0&&MsnShared.removeClass(r[0],"ev_zo_entity");t=sj_ce("a",null,"ev_zo_entity");i.innerText="";gi>=20&&(gi=0);u=n[gi];gi++;t.href=MsnShared.stringFormat(cr,encodeURI(u),fi);t.innerText=u;i.appendChild(t);sj_be(t,"click",function(){c()&&Log.Log("DHTMLClick",f,"zoentity",!1,"zoentity",t.innerHTML)});sj_be(t,"mousemove",function(n){var t=MsnShared.getElementsByClassName("ev_zo_tooltip","div",_d.body),i,r;t&&t.length>0&&(MsnShared.show(t[0]),i=n.clientX+_d.documentElement.scrollLeft,r=n.clientY+_d.documentElement.scrollTop,t[0].style.top=r+26+"px",t[0].style.left=i+"px")});sj_be(t,"mouseout",function(){var n=MsnShared.getElementsByClassName("ev_zo_tooltip","span",_d.body);n&&n.length>0&&MsnShared.hide(n[0])})}function ye(){clearInterval(kr);kr=setInterval(function(){t.ShowTrendingQuery&&at!=""?sf(at):clearInterval(kr)},7e3)}function pe(n){var r=_ge(a),u,f,t,i,h;if(/^[\u4E00-\u9FA5]{2}座$/.test(n))h=n+"幸运星座",d(h,"externallink");else{u=[{Entity:"选择你的星座，查询你今天的"+n,IsEntity:!1}];f=g("",!0,!1,u,1);r.appendChild(f);var e=sj_ce("div",null,"ev_msg_wrapper"),o=sj_ce("div",null,"ev_zo_msg_dsb"),s=[],c=["白羊座","金牛座","双子座","巨蟹座","狮子座","处女座","天秤座","天蝎座","射手座","摩羯座","水瓶座","双鱼座"];for(t=0;t<12;t++)i=sj_ce("a","ev_msg_dsb_"+t,"ev_zo_entity"),s.push(i),i.innerText=c[t],o.appendChild(i),sj_be(s[t],"click",function(n){var t=n.target.innerText+"星座运势",i;d(t,"externallink");i=g(t,!1,!1,"","1");r.appendChild(i)});e.appendChild(o);r.appendChild(e)}}function hf(){var n=getComputedStyle(_ge("ev_hook_send")).backgroundColor!="rgb(255, 255, 255)";return br=n?!0:!1}function cf(n,u){var oi=!1,h,rt,ci,et,kt,d,it,dt,nt,ht,l,ti,v,ai;try{h=JSON.parse(n)}catch(vi){return c()&&Log.Log("JsonParseError",f,"getZoChatJsonParse",!1),!1}if(h){oi=!0;rt=h.content;or=rt;var ct=h.entityInfo,si=h.target,ot=h.history,w=h.delayContents,hi=h.type;if(ei=ki=di=fi=at="",h.metadata&&(h.metadata.AnswerFeed&&(ei=h.metadata.AnswerFeed),h.metadata.EmotionInfo&&(ki=h.metadata.EmotionInfo),h.metadata.CustomLog&&(di=h.metadata.CustomLog),h.metadata.HyperLinkFormcode&&(fi=h.metadata.HyperLinkFormcode),h.metadata.TrendingQuery&&(at=h.metadata.TrendingQuery,at=JSON.parse(at),bu&&t.ShowTrendingQuery))){if(ci=_ge("ev_bubblelist_0"),et=MsnShared.getElementsByClassName("ev_zo_typing","div",ci),et&&et.length>0)for(d=0;d<et.length;d++)et[d].parentElement.parentElement.removeChild(et[d].parentElement);sf(at);ye();bu=!1}if(cu){if(h.showChatBox&&!t.DisableChatFeature&&rf(),kt=ot&&ot.chatLogs&&ot.chatLogs.length>0,!bi&&u!="externallink"&&lu&&kt)for(lu=!1,d=0;d<ot.chatLogs.length;d++)it=ot.chatLogs[d],it&&it.content&&it.entityInfo&&(kt=!0,dt=g(it.content,it.isBot,!1,it.entityInfo,it.type),nt=_ge(a),nt.appendChild(dt),nt.scrollTop=nt.scrollHeight);if(ht=sj_cook.get(yi,sr),lt){if(!bi){var dt=g(ui,!1,!1,"","1"),nt=_ge(a),gt=MsnShared.getElementsByClassName("ev_zo_typing","div",nt);gt&&gt.length>0?nt.insertBefore(dt,gt[0].parentElement):nt.appendChild(dt);nt.scrollTop=nt.scrollHeight}lt=!1;i=s;ht="1";sj_cook.set(yi,sr,"1");sj_cook.set(st,ii,s)}i==s?(ut.className=ft,tt.innerHTML=bt):i==yt?(pt.className=ft,tt.innerHTML=yr,b.src=pu):(wt.className=ft,tt.innerHTML=pr,b.src=wu);l=wi;ht!=hr?i==yt||i==ri?(MsnShared.show(b),MsnShared.hide(k),MsnShared.show(e),MsnShared.hide(r),MsnShared.hide(p),MsnShared.removeClass(o,"ev_talkbox_wrapper_min"),MsnShared.addClass(o,"ev_talkbox_wrapper"),l=pf):(ti=sj_cook.get(pi),h.isHookStr&&ti&&(nr=!0),h.isHookStr&&!ti?i!=s||sj_cook.get(lr)?t.DisableHook&&ku?(li(!1),MsnShared.hide(p),l=wr):(MsnShared.removeClass(o,"ev_talkbox_wrapper_min"),MsnShared.addClass(o,"ev_talkbox_wrapper"),_ge("ev_hook_header_text_reply").innerText=rt,hf()&&(_ge("ev_hook_header_img").className="ev_hook_header_img_dm"),ct[0].IsEntity&&t.HookHyperlink?(_ge("ev_hook_header_text_reply").innerText="",du=rt,tu(_ge("ev_hook_header_text_reply"),ct,"1")):_ge("ev_hook_header_text_reply").innerText=rt,MsnShared.show(p),MsnShared.hide(e),MsnShared.hide(r),l=yf):(uu(),MsnShared.show(r),MsnShared.hide(e),MsnShared.hide(p),l=wi):ht==vt&&kt?(li(!1),l=wr):ht==vt&&gu()?(li(!1),l=wr):(uu(),MsnShared.show(r),MsnShared.hide(e),MsnShared.hide(p),l=wi)):(uu(),MsnShared.show(r),l=i!=s?wf:wi);c()&&h.showChatBox&&(window.performance.navigation.type==1?Log.Log("FirstShowType",f,l,!1,"LoadType","Refresh"):Log.Log("FirstShowType",f,l,!1,"LoadType","FirstLoad"))}si=="a"||si=="b"?(u=="externallink"||u=="click"?(iu(),sb_st(function(){y=1;tf(ct,hi)},1500)):tf(ct,hi),su=rt,hu=(new Date).toUTCString(),v=0,w&&(ai=setInterval(function(){if(t.EnableShowAnswerFeed){var n=w[v].metadata&&w[v].metadata.AnswerFeed?w[v].metadata.AnswerFeed:"";ni(w[v].content+"["+n+"]","1")}else w[v].type?ni(w[v].content,w[v].type):ni(w[v].content,"1");v++;v==w.length&&clearInterval(ai)},3e3))):ir();cu=!1}return oi}var o=_ge("ev_talkbox_wrapper"),a="ev_talkbox",fu="ev_send_button",vi="ev_send_text",t,eu="true",ou="false",su="",hu="",er="",or="",y=0,cu=!0,lu=!0,au=!0,yi="ZHSEARCHCHATSTATUS",sr="STATUS",vt="1",hr="0",f="ChineseChatBot",cr="/search?q={0}&FORM={1}",vu="ZHLASTACTIVECHAT",pi="HOOKBLOCKINDICATOR",st="ZHSEARCHCHATCHARACTER",ii="CHARACTER",s="0",lr="ZHCHATSTRONGATTRACT",yu="ZHCHATWEAKATTRACT",yt="1",ri="2",i="0",e=sj_ce("div","ev_talkbox_max","b_hide"),p=sj_ce("div","ev_hook","b_hide"),r=sj_ce("div","ev_talkbox_min",null),rt=sj_ce("div","ev_tb_header_dropdown","ev_tb_header_dropdown_close"),ut=sj_ce("button","ev_tb_header_dropdown_button_ice","ev_tb_header_dropdown_button_ice"),pt=sj_ce("button","ev_tb_header_dropdown_button_boy","ev_tb_header_dropdown_button_boy"),wt=sj_ce("button","ev_tb_header_dropdown_button_girl","ev_tb_header_dropdown_button_girl"),ft="ev_tb_header_dropdown_button_select",nt=sj_ce("span","ev_tb_header_select_img","ev_tb_header_select_close"),tt=sj_ce("a","ev_tb_header_default_text","ev_tb_header_default_text"),v=sj_ce("div","ev_tb_disable_setting","b_hide"),l=sj_ce("div","ev_disable_popup_setting","b_hide"),ht=sj_ce("div","ev_disable_popup_background","b_hide"),w=sj_ce("img","ev_search_bar_animation",""),it=sj_ce("div","ev_show_enlarge_img","b_hide"),ct=sj_ce("img","ev_enlarge_img","ev_enlarge_img"),ar=sj_ce("div","ev_enlarge_close","ev_enlarge_close"),lf=sj_ce("div","ev_enlarge_background","ev_enlarge_background"),u=new Image,et,vr,bt="小冰",yr="虚拟男友",pr="虚拟女友",b=sj_ce("iframe","ev_iframe_talk","b_hide"),k=sj_ce("div","ev_default_talk",null),h=sj_ce("span","ev_min_zo_img",null),pu="https://ux-plus-bing.xiaoice.com/BingVirtualBF",wu="https://ux-plus-bing.xiaoice.com/BingVirtualGF",af="在【旧版本浏览器】和【阻止第三方Cookie】的设置下不支持召唤虚拟伴侣, 请尝试切换到新版Edge进行体验或打开允许站点读取cookie的相关设置",vf="快来定制你的专属虚拟伴侣吧！ ",yf="HookChatBox",wr="MaxDefaultChatBox",pf="MaxVirtualChatBox",wi="MinDefaultChatBox",wf="MinVirtualChatBox",lt=!1,ui,bi=!1,fi="",br=!1,ei="",ki="",di="",at="",gi=0,kr,bu=!0,nr=!1,ku=!1,dr=!1,gr=!1,oi=!1,tr=!1,si=!1,kt=!1,hi,dt,ci,gt="",nu="HOOKPOPUPCLICK",du="";n.init=bf})(ChineseChatV2||(ChineseChatV2={}))